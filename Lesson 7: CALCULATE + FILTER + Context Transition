Lesson 7: CALCULATE + FILTER + Context Transition

Now your example:
‚ùì Test = CALCULATE(SUM(Sales[Amount]))

If you put this inside a visual, or evaluate the measure normally:

‚û§ What is the result?
It returns exactly the same value as:
Total Sales = SUM(Sales[Amount])
Why?
Because in a measure, there is NO row context, only filter context.
So CALCULATE() has no row context to convert ‚Üí no context transition happens ‚Üí it behaves normally.
BT ‚Äî If you use this inside a CALCULATED COLUMN:
Example:
Test = CALCULATE( SUM(Sales[Amount]) )
Imagine this table:
Product	Amount
A	100
A	200
B	300
For row 1 (Product A, Amount 100)

Row context = A
CALCULATE applies context transition ‚Üí Converts this row into filters:

Product = A
Amount = 100


Then this is executed:

SUM(Sales[Amount]) WHERE Product='A'


So instead of returning 100, it returns:

100 + 200 = 300

Each row A will return 300.
Each row B will return 300.

So your column will be:

Product	Amount	Test
A	100	300
A	200	300
B	300	300
‚≠ê KEY RULE

CALCULATE in a measure = NO context transition.
CALCULATE in a calculated column = YES context transition.

üìå Why this happens?

Because:

Measures have filter context only

Calculated columns have row context

CALCULATE = ‚Äúconvert row context ‚Üí filter context‚Äù

This is the engine of DAX.
When you use CALCULATE inside a Row Context, DAX automatically converts that row context into a filter context.


1. A 650
B 200
C 150

2. sales_by_customer = calculate(sum[sales[amount]))

3. Total Sales for Orders Above Quantity 10
calculate(sum(sales[amount]), filter(sales, sales[qty] > 10))

4. Sales of a Selected Product Only
=calculate(sum(sales[amount]), filter(products, product[productname]) ='computer') - You want ONLY ‚Äúcomputer‚Äù always

Values version - You want the slicer-selected product

Sales_Selected_Product =
CALCULATE(
    SUM(Sales[Amount]),
    VALUES(Products[ProductName])
)

5. Sales for TOP 10 Highest Sale Customers
=calculate(sum(sales[amount]), topn(10, summarize(sales, sale[customer_id], 'custsales', sum(sales[amount])),
[custsales], desc))  # outer sum  - final total sales for Top 10 customers combined.

# You want a table result (Top 10 customers with their sales)
Top10_Customers_Table =
TOPN(
    10,
    SUMMARIZE(
        Sales,
        Sales[CustomerID],
        "CustSales", SUM(Sales[Amount])
    ),
    [CustSales], DESC
)



